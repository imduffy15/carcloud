<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="current_timestamp" dbms="postgresql"/>

    <changeSet author="duffy (generated)" id="1416701746711-1">
        <createTable tableName="hibernate_sequences">
            <column name="sequence_name" type="VARCHAR(255)"/>
            <column name="sequence_next_hi_value" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-2">
        <createTable tableName="oauth_access_token">
            <column name="token_id" type="VARCHAR(255)"/>
            <column name="token" type="BLOB"/>
            <column name="authentication_id" type="VARCHAR(255)"/>
            <column name="user_name" type="VARCHAR(255)"/>
            <column name="client_id" type="VARCHAR(255)"/>
            <column name="authentication" type="BLOB"/>
            <column name="refresh_token" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-3">
        <createTable tableName="oauth_approvals">
            <column name="userid" type="VARCHAR(255)"/>
            <column name="clientid" type="VARCHAR(255)"/>
            <column name="scope" type="VARCHAR(255)"/>
            <column name="status" type="VARCHAR(255)"/>
            <column name="expiresat" type="TIMESTAMP"/>
            <column name="lastmodifiedat" type="TIMESTAMP"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-4">
        <createTable tableName="oauth_client_details">
            <column name="client_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="resource_ids" type="VARCHAR(255)"/>
            <column name="CLIENT_SECRET" type="VARCHAR(255)"/>
            <column name="scope" type="VARCHAR(255)"/>
            <column name="authorized_grant_types" type="VARCHAR(255)"/>
            <column name="web_server_redirect_uri" type="VARCHAR(255)"/>
            <column name="authorities" type="VARCHAR(255)"/>
            <column name="access_token_validity" type="INT"/>
            <column name="refresh_token_validity" type="INT"/>
            <column name="additional_information" type="VARCHAR(255)"/>
            <column name="autoapprove" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-5">
        <createTable tableName="oauth_client_token">
            <column name="token_id" type="VARCHAR(255)"/>
            <column name="token" type="BLOB"/>
            <column name="authentication_id" type="VARCHAR(255)"/>
            <column name="user_name" type="VARCHAR(255)"/>
            <column name="client_id" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-6">
        <createTable tableName="oauth_code">
            <column name="code" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-7">
        <createTable tableName="oauth_refresh_token">
            <column name="token_id" type="VARCHAR(255)"/>
            <column name="token" type="BLOB"/>
            <column name="authentication" type="BLOB"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-8">
        <createTable tableName="t_authority">
            <column name="name" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-9">
        <createTable tableName="t_device">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="VARCHAR(50)" defaultValue="system">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" defaultValueDate="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(50)"/>
            <column name="last_modified_date" type="timestamp"/>
            <column name="version" type="INT"/>
            <column name="description" type="VARCHAR(150)"/>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-10">
        <createTable tableName="t_device_owner">
            <column name="device_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-11">
        <createTable tableName="t_persistent_audit_event">
            <column name="event_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="event_date" type="timestamp"/>
            <column name="event_type" type="VARCHAR(255)"/>
            <column name="principal" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-12">
        <createTable tableName="t_persistent_audit_event_data">
            <column name="event_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-13">
        <createTable tableName="t_user">
            <column name="email" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="VARCHAR(50)" defaultValue="system">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" defaultValueDate="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(50)"/>
            <column name="last_modified_date" type="timestamp"/>
            <column name="version" type="INT"/>
            <column name="first_name" type="VARCHAR(50)"/>
            <column name="last_name" type="VARCHAR(50)"/>
            <column name="password" type="VARCHAR(100)"/>
            <column name="phone" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-14">
        <createTable tableName="t_user_authority">
            <column name="email" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-15" context="prod">
        <addPrimaryKey columnNames="name" constraintName="PRIMARY" tableName="t_authority"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-16" context="prod">
        <addPrimaryKey columnNames="id" constraintName="PRIMARY" tableName="t_device"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-17" context="prod">
        <addPrimaryKey columnNames="device_id, email" constraintName="PRIMARY" tableName="t_device_owner"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-18" context="prod">
        <addPrimaryKey columnNames="event_id" constraintName="PRIMARY" tableName="t_persistent_audit_event"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-19" context="prod">
        <addPrimaryKey columnNames="event_id, name" constraintName="PRIMARY" tableName="t_persistent_audit_event_data"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-20" context="prod">
        <addPrimaryKey columnNames="email" constraintName="PRIMARY" tableName="t_user"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-21" context="prod">
        <addPrimaryKey columnNames="email, name" constraintName="PRIMARY" tableName="t_user_authority"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-22" context="prod">
        <addForeignKeyConstraint baseColumnNames="email" baseTableName="t_device_owner"
                                 constraintName="FK_a7w4v8nvob8unjp443af3l4i1" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="email" referencedTableName="t_user"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-23" context="prod">
        <addForeignKeyConstraint baseColumnNames="device_id" baseTableName="t_device_owner"
                                 constraintName="FK_ajld8l002xq11wn0x3akffj1b" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="t_device"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-24" context="prod">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="t_persistent_audit_event_data"
                                 constraintName="FK_cekdwiaydjn97qi7ebeexb1bw" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="event_id" referencedTableName="t_persistent_audit_event"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-25" context="prod">
        <addForeignKeyConstraint baseColumnNames="email" baseTableName="t_user_authority"
                                 constraintName="FK_ck38oabii4y4cf5coi2w5lfia" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="email" referencedTableName="t_user"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1416701746711-26" context="prod">
        <addForeignKeyConstraint baseColumnNames="name" baseTableName="t_user_authority"
                                 constraintName="FK_tghvo3hwad0ifdm39n7bph8b" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="name" referencedTableName="t_authority"/>
    </changeSet>
    <changeSet author="duffy (generated)" id="1415254705959-29">
        <loadData encoding="UTF-8"
                  file="config/liquibase/users.csv"
                  separator=";"
                  tableName="t_user">
        </loadData>
        <loadData encoding="UTF-8"
                  file="config/liquibase/authorities.csv"
                  separator=";"
                  tableName="t_authority"/>

        <loadData encoding="UTF-8"
                  file="config/liquibase/users_authorities.csv"
                  separator=";"
                  tableName="t_user_authority"/>

        <loadData encoding="UTF-8"
                  file="config/liquibase/devices.csv"
                  separator=";"
                  tableName="t_device"/>

        <loadData encoding="UTF-8"
                  file="config/liquibase/devices_owners.csv"
                  separator=";"
                  tableName="t_device_owner"/>
    </changeSet>
</databaseChangeLog>
